<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>tracking.js - first tracking</title>
  <script src="./tracking-min.js"></script>
  <script src="./face-min.js"></script>
  <script src="./eye-min.js"></script>
  <script src="./mouth-min.js"></script>
  <style>
    .container {
      position: absolute;
      left: 0;
      top: 0;
    }
    .video {
      position: absolute;
      left: 0;
      top: 0;
    }
    .overlay {
      position: absolute;
      left: 0;
      top: 0;
      width: 400px;
      height: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <video id="myVideo" class="video" width="400" height="300" preload autoplay loop muted></video>
    <canvas id="myOverlay" class="overlay" width="800" height="600"></canvas>
  </div>
  <script>
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || window.navigator.mozGetUserMedia;
  window.URL = window.URL || window.webkitURL;

  var img = new Image()
  img.src = './Laughing_man.png';
  var imgWidth, imgHeight;
  img.onload = function() {
    console.log(img.width, img.height);
    imgWidth = img.width;
    imgHeight = img.height;
  }


  var canvas = document.getElementById('myOverlay');
  var ctx = canvas.getContext('2d');
  ctx.strokeStyle = '#0F0';
  ctx.lineWidth = 1;

  var video = document.getElementById('myVideo');
  var localStream = null;
  navigator.getUserMedia({video: true, audio: false},
    function(stream)  {  //  for  success  case
      console.log(stream);
      video.src = window.URL.createObjectURL(stream);
    },
    function(err)  {  //  for  error  case
      console.log(err);
    }
  );

  var objects = new tracking.ObjectTracker(['face']);

  objects.on('track', function(event) {
    // console.log(event)
    ctx.clearRect(0, 0, 800, 600);
    if (event.data.length === 0) {
      // No objects were detected in this frame.
    } else {
      event.data.forEach(function(rect) {
        var width, height;
        if (rect.width > rect.height) {
          width = rect.width;
          height = rect.width * imgHeight / imgWidth;
        } else {
          width = rect.height * imgWidth / imgHeight;
          height = rect.height;
        }
        ctx.beginPath();
        ctx.strokeRect(rect.x * 2, rect.y * 2, rect.width * 2, rect.height * 2);
        ctx.drawImage(img, rect.x * 2, rect.y * 2, width * 2, height * 2);
      });
    }
  });
  tracking.track('#myVideo', objects);

  </script>
</body>
</html>
